<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Document</title>
   <script src='https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.11/vue.js'></script>
</head>
<body>
   <div id="app">
      <button v-if="!isLogin" @click="loginHandler">login</button>
      <button v-else @click="logoutHandler">logout</button>
      <div v-if="isLogin">
         <p>name: {{ user.name }}</p>
         <p>user: {{ user.email }}</p>
         <img :src="user.picture" alt="">
      </div>
   </div>

   <script>
      (function(d, s, id){
         var js, fjs = d.getElementsByTagName(s)[0];
         if (d.getElementById(id)) {return;}
         js = d.createElement(s); js.id = id;
         js.src = "https://connect.facebook.net/en_US/sdk.js";
         fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));
   </script>
   <script>
      new Vue({
         el: '#app',
         data: () => ({
            isLogin: false,
            user: {
               name: '',
               email: '',
               picture: ''
            }
         }),
         methods: {
            checkLoginStatus() {
               FB.getLoginStatus(res => {
                  console.log(res);
                  if (res.status === 'unknown') {
                     this.isLogin = false;
                  } else if (res.status === 'connected') {
                     this.isLogin = true;
                  }
               });
            },
            loadFbSdk() {
               window.fbAsyncInit = () => {
                  FB.init({
                     appId: '2611139062329868',
                     cookie: true,
                     xfbml: true,
                     version: 'v6.0'
                  });
                  FB.AppEvents.logPageView();
                  this.checkLoginStatus();
               };
            },
            loginHandler() {
               FB.login(res => {
                  if (res.status === 'connected') {
                     if (res.status === 'connected') this.getFbProfile();
                  }
               }, {
                  scope: 'email, public_profile',
                  return_scopes: true
               });
            },
            getFbProfile() {
               FB.api('/me?fields=id,name,email,picture.width(100).height(100)', res => {
                  this.user = { 
                     name: res.name,
                     email: res.email,
                     picture: res.picture.data.url
                  }
                  this.isLogin = true;
               });
            },
            logoutHandler() {
               FB.logout(res => { 
                  this.isLogin = false;
                  this.user = {};
               });
            }
         },
         mounted() {
            this.loadFbSdk();
         }
      });


   </script>
</body>
</html>