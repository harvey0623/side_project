<!DOCTYPE html>
<html lang="en">

<head>
	<title>卡片移轉確認</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="icon" href="" type="image/jpg" sizes="16x16">
	<link rel="stylesheet" href="./lib/fontIcon/css/all.min.css">
	<link rel='stylesheet' href='./lib/bs4/bootstrap.min.css'/>
	<link rel="stylesheet" href="./css/main.css">
	<link rel="stylesheet" href="./css/transferCheck.css">
	<script src='./lib/jquery.3.4.1.min.js'></script>
	<script src='./lib/bs4/bootstrap.bundle.min.js'></script>
	<script src='./lib/vue.js'></script>
	<script src="./lib/vee-validate.js"></script>
</head>

<body>
	<div id="app" v-cloak>
		<div class="mycontainer">
			<p class="transferTip">
				將移轉來源卡片的所有「餘額」及「金點」點數至目標卡片裡，請確認來源卡片及目標卡片後進行移轉。
			</p>
			<div class="transferBox" v-if="originCard !== null">
				<ul class="transferLayout">
					<li>
						<div class="transferBody">
							<div class="transferL">
								<p class="cardName">{{ originCard.cardName }}(來源卡片)</p>
								<img class="cardImg" :src="originCard.imgUrl" alt="">
							</div>
							<div class="transferR">
								<p class="cardNumber">{{ originCard.cardNumber }}</p>
								<div class="remainPoint">
									<div class="pointBox pointL">
										<h3 class="pointTitle">金點</h3>
										<p class="pointNumber">{{ originCard.point | currency }}</p>
									</div>
									<div class="pointBox pointR">
										<h3 class="pointTitle">餘額</h3>
										<p class="pointNumber">${{ originCard.dollar | currency }}</p>
									</div>
								</div>
							</div>
						</div>
					</li>
				</ul>
				<div class="arrowBox">
					<p><i class="far fa-angle-down"></i></p>
					<p><i class="far fa-angle-down"></i></p>
				</div>
				<ul class="transferLayout">
					<li>
						<div class="transferBody">
							<div class="transferL">
								<p class="cardName">{{ transferCard.cardName }}(目標卡片)</p>
								<img class="cardImg" :src="transferCard.imgUrl" alt="">
							</div>
							<div class="transferR">
								<p class="cardNumber">{{ transferCard.cardNumber }}</p>
								<div class="remainPoint">
									<div class="pointBox pointL">
										<h3 class="pointTitle">金點</h3>
										<p class="pointNumber">{{ transferCard.point | currency }}</p>
									</div>
									<div class="pointBox pointR">
										<h3 class="pointTitle">餘額</h3>
										<p class="pointNumber">${{ transferCard.dollar | currency }}</p>
									</div>
								</div>
							</div>
						</div>
					</li>
				</ul>
			</div>
		</div>

		<div class="fixLink">
			<a href="javascript:;" @click="showModal">確認移轉</a>
		</div>

		<!-- 轉移modal -->
		<div
			class="modal fade mymodal" 
			id="inputModal" 
			data-backdrop="static" 
			ref="inputModal">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title">請輸入會員密碼</h1>
					</div>
					<validation-observer tag="div" class="modal-body" ref="form">
						<p>請輸入您的會員密碼確認移轉卡片所有的「餘額」及「金點」</p>
						<validation-provider 
							tag="div" 
							class="inputBox" 
							rules="required|password"
							v-slot="{ errors }">
							<input 
								type="password" 
								class="form-control" 
								placeholder="輸入6-20字元會員密碼"
								maxLength="20"
								v-updatefocus="isFocus"
								v-model.trim="password">
							<p class="validate-error">{{ errors[0] }}</p>
						</validation-provider>
					</validation-observer>
					<div class="modal-footer">
						<p @click="cancelHandler">取消</p>
						<p @click="submitHandler">掛失</p>
					</div>
				</div>
			</div>
		</div>

		<!-- 提示modal(密碼有誤)-->
		<div class="modal fade mymodal tipModal" id="msgModal" data-backdrop="static">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title">提示</h1>
					</div>
					<div class="modal-body">
						<p>密碼有誤</p>
					</div>
					<div class="modal-footer">
						<p onclick="$('.tipModal').modal('hide')">確認</p>
					</div>
				</div>
			</div>
		</div>

	</div>

	<script src="./js/components/veevalidate.js"></script>
	<script src="./js/components/all.js"></script>
	<script>
		new Vue({
			el: '#app',
			data: () => ({
				isFocus: false,
				transferData: {},
				inputModal: null,
				password: ''
			}),
			computed: {
				originCard() {
					if (this.transferData.origin !== undefined) return this.transferData.origin;
					else return null;
				},
				transferCard() {
					if (this.transferData.target !== undefined) return this.transferData.target;
					else return null;
				}
			},
			methods: {
				initModal() {
					this.inputModal = $(this.$refs.inputModal);
					this.inputModal.on('hidden.bs.modal', this.hiddenHandler);
					this.inputModal.on('shown.bs.modal', this.showHandler);
				},
				showModal() {
					this.resetForm();
					this.inputModal.modal('show');
				},
				cancelHandler() {
					this.resetForm();
					this.inputModal.modal('hide');
				},
				showHandler() {
					this.isFocus = true;
				},
				hiddenHandler() {
					this.password = '';
					this.isFocus = false;
				},
				resetForm() {
					this.$refs.form.reset();
				},
				async submitHandler() {
					let isValid = await this.$refs.form.validate().then(res => res);
					if (!isValid) return;
					this.isFocus = false;
					//====密碼有誤顯示提示modal
					setTimeout(() => {
						this.inputModal.modal('hide');
						if (false) {
							$('.lossModal').modal('show');
						} else {
							$('.tipModal').modal('show');
						}
					}, 2000);
				}
			},
			mounted() {
				this.initModal();
				this.transferData = {
					origin: {
						id: 'aaa',
						cardName: '摩斯行動卡',
						imgUrl: 'https://fakeimg.pl/350x200/?text=Card',
						cardNumber: 'abc123456',
						point: 1000,
						dollar: 1000
					},
					target: {
						id: 'bbb',
						cardName: '摩斯二代卡',
						imgUrl: 'https://fakeimg.pl/350x200/?text=Card',
						cardNumber: 'abc123654',
						point: 500,
						dollar: 2000
					}
				}
			}
		});
	</script>
</body>

</html>